## Spack Architecture

- **Packages**
- **Environment**
- **Configuration**


### Packages

- Package build recpipes are written in Python using the Spack Package API.
- Spack has nearly 8000 packages.
- **Example**: Imp ```package.py```:

```python
from spack.package import *
from spack.pkg.builtin.boost import Boost

class Imp(CMakePackage):
    '''IMP, the Integrative Modeling Platform.'''

    homepage = "https://integrativemodeling.org"
    url = "https://github.com/salilab/imp/archive/2.8.0.tar.gz"

    license("LGPL-2.1-or-later")

    version("2.8.0", sha256="0b46b8988febd7cdfc5838849007f9a547493ed4b6c752fe54571467eeb1acd2")

    depends_on("python@2.7:")
    depends_on("swig")
    depends_on("boost@1.40:")

    # TODO: replace this with an explicit list of components of Boost,
    # for instance depends_on('boost +filesystem')
    # See https://github.com/spack/spack/pull/22303 for reference
    depends_on(Boost.with_default_variants)
    depends_on("hdf5")
    depends_on("eigen")
```


### Environment

- Spack packages are installed in environments.
- Environments are defined in a YAML file (`spack.yaml`).
- `spack.yaml` defines:
  - **Required**: Environment packages
  - **Optional**: Environment-specific configuration properties


### Configuration

Spack configuration is managed through a set of YAML files:

- `config.yaml`
- `compilers.yaml`
- `packages.yaml`
- `modules.yaml`
- `mirrors.yaml`


**config.yaml**
___
- `build_jobs`: Number of parallel build jobs.
- `install_tree`: Directory for installed packages.
- `build_stage`: Temporary location for package builds.
- `module_roots`: Directory for environment module files.

```yaml
config:
  install_hash_length: 7
  build_jobs: 4
  build_stage: ${SPACK_STACK_DIR}/cache/build_stage
  install_tree:
    root: $env/install
 ```


**compilers.yaml**

___
- A configuration file in spack that specifies available compilers
- Autogenerated by spack via `spack compiler find`
```yaml
compilers::
  - compiler:
      spec: gcc@=12.2.0
      paths:
        cc: /home/astokely/projects/spack-stack/spack/var/spack/environments/base/.spack-env/view/bin/gcc
        cxx: /home/astokely/projects/spack-stack/spack/var/spack/environments/base/.spack-env/view/bin/g++
        f77: /home/astokely/projects/spack-stack/spack/var/spack/environments/base/.spack-env/view/bin/gfortran
        fc: /home/astokely/projects/spack-stack/spack/var/spack/environments/base/.spack-env/view/bin/gfortran
      flags: {}
      operating_system: almalinux9
      target: x86_64
      modules:
      - gcc/12.2.0
      environment: {}
      extra_rpaths: []
 ```



